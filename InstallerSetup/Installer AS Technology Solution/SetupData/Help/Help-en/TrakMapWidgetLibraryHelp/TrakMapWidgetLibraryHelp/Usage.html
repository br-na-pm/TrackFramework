

<html>
	
<head>
	<title>Usage</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="generator" content="HelpNDoc Professional Edition 6.4.0.357">
	<meta name="description" content="This is a brief overview of how to implement the Acopos Trak paper widget." /> 
	<meta name="keywords" content="">
	
	
	
	<link type="text/css" rel="stylesheet" media="all" href="css/reset.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/base.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/hnd.css" />
	<!--[if lte IE 8]>
		<link type="text/css" rel="stylesheet" media="all" href="css/ielte8.css" />
	<![endif]-->
	<style type="text/css">
		#topic_header
		{
			background-color: #EFEFEF;
		}
	</style>

	
	
</head>

<body>



	
	
	<div id="topic_content">
		
<p></p>
<h1 class="rvps4"><span class="rvts0"><span class="rvts13">Usage</span></span></h1>
<p class="rvps2"><span class="rvts22">Prepare a working Acopos Trak Project</span></p>
<p class="rvps2"><span class="rvts14">To start with the trak map, you should start from a project that has a working trak layout and has an SVG that was automatically generated using the SVGData file device in your project.</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><span class="rvts19">Requirements:</span></p>
<p class="rvps2"><span class="rvts14">- Working Acopos Trak Project and layout (project compiles and can succesfully power on the assembly and move shuttles)</span></p>
<p class="rvps2"><span class="rvts14">- Automatically generated SVG from the SVGData file device </span></p>
<p class="rvps2"><span class="rvts14">- 5.13+ MpMotion Version</span></p>
<p class="rvps9"><span class="rvts14">The python script only supports versions 5.13-5.15. After generating an SVG in a supported version, then the user can upgrade their project to a newer version.</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><span class="rvts22">Import the TrakMap Technology Solution</span></p>
<p class="rvps2"><span class="rvts14">Place the provided technology solution in the Automation Studio technology solutions folder (BrAutomationInstallationFolder)/(AutomationStudioVersion)/AS/TechnologySolutions. In your project, select the root node in the logical view, in the toolbox select to add a Technology Solution package and select the TrakMap application package that appears.</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><span class="rvts22">Running the TrakMapImporter program</span></p>
<p class="rvps2"><span class="rvts12">We have created a simple tool to help assist in the parsing of the SVG and other steps needed to use the trak map.</span></p>
<p class="rvps2"><span class="rvts12">Download and run the provided </span><a class="rvts21" href="../../../technologysolutions/ts_trakmapwidgetlibrary/TrakMapImporter.exe">.exe</a></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts12">There is a prompt for 4 inputs:</span></p>
<ol style="text-indent: 0px; padding: 0; margin: 0 0 0 48px; list-style-position: outside; list-style-type: decimal;">
<li value="1" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts12">Initial SVG </span></span></li>
<li value="2" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts12">Export Folder </span></span></li>
<li value="3" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts12">Export File Name </span></span></li>
<li value="4" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts12">TrakDiag SegDefinition.st action file path </span></span></li>
</ol>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><img alt="" style="padding : 1px;" src="lib/TrackMapBuilderScreenshot.png"></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts12">The initial SVG should be the file name for the exported SVG from Automation Runtime. The export folder is the location in which you'd like to generate the SVG for the paper widget itself. The Export file name is the name of the exported SVG you'd like to have. The final input is the file location of the SegDefine.st action under the provided TrakDiag task.</span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts12">The program when </span><span class="rvts20">Generate</span><span class="rvts12">&nbsp;is pressed, will process the provided SVG and create a formatted SVG for the paper widget. Additionally it will populate the action with the segment names and assembly name. Upon completion of the export, you should validate that the values are correct from your project.</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><span class="rvts14">Upon succesful generation you will need to make sure your output svg is placed into your project's Visualization Resources folder to ensure that it is transfered to the target.</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><span class="rvts14">Before deploying, be sure to correctly set the Assembly and ShuttleMon values of the paperCore FUB in the intialization routine of the TrakDiag task. For example:</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><span class="rvts32"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts32">paperCore.Assembly</span><span class="rvts33">&nbsp;</span><span class="rvts34">:=</span><span class="rvts33">&nbsp;</span><span class="rvts31">ADR</span><span class="rvts34">(gSampleTrak);</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34">paperCore.ShuttleMon</span><span class="rvts33">&nbsp;</span><span class="rvts34">:=</span><span class="rvts33">&nbsp;</span><span class="rvts31">ADR</span><span class="rvts34">(gShuttleMon);</span></p>
<h5 class="rvps8"><span class="rvts0"><span class="rvts23">Deploy to your Software Configuration</span></span></h5>
<p class="rvps2"><span class="rvts14">To your project add the trak paper library and the </span><span class="rvts19">TrakDiag</span><span class="rvts14">&nbsp;task. The TrakDiag task is the task that automatically implements the TrakPaper Core function block and supporting function blocks. The TrakDiag task must be added to the cyclic 8 task class (or a large idle time task class)</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<h5 class="rvps8"><span class="rvts0"><span class="rvts23">Additional Library dependancies</span></span></h5>
<p class="rvps2"><span class="rvts14">If not already in your project, make sure to add the following libraries and deploy them to your currrent configuration:</span></p>
<ul style="text-indent: 0px; padding: 0; margin: 0 0 0 24px; list-style-position: outside; list-style-type: disc;">
<li class="rvps2"><span class="rvts14">standard</span></li>
<li class="rvps2"><span class="rvts14">AsIoDiag</span></li>
<li class="rvps2"><span class="rvts14">AsBrStr</span></li>
</ul>
<h5 class="rvps8"><span class="rvts0"><span class="rvts23">Setting up the Paper widget</span></span></h5>
<p class="rvps2"><span class="rvts14">The final step that must be done is to connect to the paper widget and custom status widget.</span></p>
<p class="rvps2"><span class="rvts14">You'll need to enable the following local variables in OPC-UA for the TrakDiag task (make sure to set the variables to be automatic enable).</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<ol style="text-indent: 0px; padding: 0; margin: 0 0 0 48px; list-style-position: outside; list-style-type: decimal;">
<li value="1" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">TrakDiag:paperCore.SvgTransform </span></span></li>
<li value="2" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">TrakDiag:paperCore.SvgContent </span></span></li>
<li value="3" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">TrakDiag:paperCore.ClickData</span></span></li>
<li value="4" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">TrakDiag:ShuttleUserData</span></span></li>
<li value="5" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">TrakDiag:paperCore.ClickID</span></span></li>
<li value="6" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">TrakDiag:paperCore.ReadClickID</span></span></li>
</ol>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><span class="rvts15">Paper Widget</span></p>
<p class="rvps2"><span class="rvts12">You'll need to add a paper widget to your HMI content page you wish to show the trak map on. </span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts12">Once added to your content, to the paper widget, select the SvgFilePath to be the generated SVG from the previous step (this SVG must be placed in the Logical\mappView\Resources\Media folder), map the paperCore variable SvgTransform and SvgContent variables from the TrakDiag task.</span></p>
<p class="rvps2"><span class="rvts12">The Trak paper widget uses the color List property of the paper widget for the segment status colors during operation. The default color values could be the following: </span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts12">#C9C9C9,#FF0000,#00FF00,#FFFF80</span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts12">The important part is that the following indices are used for the styling of the segments</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<div class="rvps2"><table border="0" cellpadding="0" cellspacing="0" style="border-width: 0px; border-spacing: 0px;">
<tr valign="top">
<td width="448" valign="middle" style="padding: 0px;"><p class="rvps3"><span class="rvts20">Style Description</span></p>
</td>
<td width="64" valign="middle" style="padding: 0px;"><p class="rvps3"><span class="rvts20">Index</span></p>
</td>
</tr>
<tr valign="top">
<td width="448" valign="middle" style="padding: 0px;"><p class="rvps2"><span class="rvts12">Segment Default Style</span></p>
</td>
<td width="64" valign="middle" style="padding: 0px;"><p class="rvps2"><span class="rvts12">0</span></p>
</td>
</tr>
<tr valign="top">
<td width="448" valign="middle" style="padding: 0px;"><p class="rvps2"><span class="rvts12">Segment is in an error state</span></p>
</td>
<td width="64" valign="middle" style="padding: 0px;"><p class="rvps2"><span class="rvts12">1</span></p>
</td>
</tr>
<tr valign="top">
<td width="448" valign="middle" style="padding: 0px;"><p class="rvps2"><span class="rvts12">Segment is okay style</span></p>
</td>
<td width="64" valign="middle" style="padding: 0px;"><p class="rvps2"><span class="rvts12">2</span></p>
</td>
</tr>
<tr valign="top">
<td width="448" valign="middle" style="padding: 0px;"><p class="rvps2"><span class="rvts12">Segment is in a warning state style</span></p>
</td>
<td width="64" valign="middle" style="padding: 0px;"><p class="rvps2"><span class="rvts12">3</span></p>
</td>
</tr>
</table>
</div>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts12">Custom styling is possible by changing the color at the defined index.</span></p>
<p class="rvps2"><span class="rvts12">In order to use the segment details, the </span><span class="rvts20">clickID</span><span class="rvts12">&nbsp;and </span><span class="rvts20">ReadClickID</span><span class="rvts12">&nbsp; property must be set for the Paper Widget. This can be done by using the below code block in an event binding and setting the </span><span class="rvts20">contentRefId</span><span class="rvts12">&nbsp;and </span><span class="rvts20">widgetRefId</span><span class="rvts12">&nbsp;correctly. On a click, this event binding passes the </span><span class="rvts14">ClickID</span><span class="rvts12">&nbsp;to the paper core, and it commands the paper core to read the </span><span class="rvts14">ClickID</span><span class="rvts12">&nbsp;and refresh the ClickData.</span></p>
<p class="rvps7"><span class="rvts12"></span><br/><span class="rvts29">&nbsp; &nbsp;&nbsp;</span><span class="rvts24">&nbsp; &lt;EventBinding id="content_trakmap.paperTrakMap.Click"&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &lt;Source xsi:type="widgets.brease.Paper.Event" contentRefId="trakmapContent" widgetRefId="paperTrakMap" event="Click" /&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &lt;EventHandler&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &lt;Sequence&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Step order="0"&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Action&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Target xsi:type="opcUa.NodeAction" refId="NS6|String|Diag::TrakDiag:paperCore.ClickID"&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Method xsi:type="opcUa.NodeAction.SetValueString" value="= elementId" /&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/Target&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/Action&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/Step&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Step order="1"&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Action&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Target xsi:type="opcUa.NodeAction" refId="NS6|String|Diag::TrakDiag:paperCore.ReadClickID"&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;Method xsi:type="opcUa.NodeAction.SetValueBool" value="true" /&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/Target&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/Action&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp; &lt;/Step&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &nbsp; &lt;/Sequence&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &nbsp; &lt;/EventHandler&gt;</span></p>
<p class="rvps7"><span class="rvts24">&nbsp; &nbsp; &lt;/EventBinding&gt;</span></p>
<p class="rvps2"><span class="rvts15"><br/></span></p>
<p class="rvps2"><span class="rvts15">Custom Segment Status Widget</span></p>
<p class="rvps2"><span class="rvts12">To use the custom segment status widget, after importing that technology solution you will need to "Build Widget Library" in Automation Studio, Project-&gt;"Build Widget Library". </span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts12">Add the SegmentStatus widget into your content wherever you desire. Connect the TrakDiag:paperCore.ClickData.Segment.Data variable to the widget. Also, connect the TrakDiag:paperCore.ClickData.Segment.Valid vairable to the visible property of the widget.</span></p>
<p class="rvps2"><span class="rvts24"><br/></span></p>
<p class="rvps2"><span class="rvts12">Additionally, you will need to connect the status snippets to the custom widget. Using the below code block in your content binding and set the </span><span class="rvts20">contentRefId </span><span class="rvts12">and </span><span class="rvts20">widgetRefId </span><span class="rvts12">correctly</span></p>
<p class="rvps2"><span class="rvts24"></span><br/><span class="rvts24">&lt;</span><span class="rvts25">Binding</span><span class="rvts26">&nbsp;</span><span class="rvts27">mode</span><span class="rvts24">="</span><span class="rvts28">oneWay</span><span class="rvts24">"&gt;</span><br/><span class="rvts24"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">&lt;</span><span class="rvts25">Source</span><span class="rvts26">&nbsp;</span><span class="rvts27">xsi:type</span><span class="rvts24">="</span><span class="rvts28">opcUa</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts27">refId</span><span class="rvts24">="::</span><span class="rvts28">TrakDiag:clickedSegment.Status.ErrorCode</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts27">attribute</span><span class="rvts24">="</span><span class="rvts28">value</span><span class="rvts24">"/&gt;</span><br/><span class="rvts24"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">&lt;</span><span class="rvts25">Target</span><span class="rvts26">&nbsp;</span><span class="rvts27">xsi:type</span><span class="rvts24">="</span><span class="rvts28">snippet</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts27">refId</span><span class="rvts24">="</span><span class="rvts28">SnippetSegError</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts27">attribute</span><span class="rvts24">="</span><span class="rvts28">value</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts24">/&gt;</span><br/><span class="rvts24">&lt;/</span><span class="rvts25">Binding</span><span class="rvts24">&gt;</span><br/><span class="rvts24">&lt;</span><span class="rvts25">Binding</span><span class="rvts26">&nbsp;</span><span class="rvts27">mode</span><span class="rvts24">="</span><span class="rvts28">oneWay</span><span class="rvts24">"&gt;</span><br/><span class="rvts24"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">&lt;</span><span class="rvts25">Source</span><span class="rvts26">&nbsp;</span><span class="rvts27">xsi:type</span><span class="rvts24">="</span><span class="rvts28">snippet</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts27">refId</span><span class="rvts24">="</span><span class="rvts28">SnippetSegError</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts27">attribute</span><span class="rvts24">="</span><span class="rvts28">value</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts24">/&gt;</span><br/><span class="rvts24"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts24">&lt;</span><span class="rvts25">Target</span><span class="rvts26">&nbsp;</span><span class="rvts27">xsi:type</span><span class="rvts24">="</span><span class="rvts28">brease</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts27">contentRefId</span><span class="rvts24">="</span><span class="rvts28">segmentDetailsContent</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts27">widgetRefId</span><span class="rvts24">="</span><span class="rvts28">SegmentStatus1</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts27">attribute</span><span class="rvts24">="</span><span class="rvts28">segErrorText</span><span class="rvts24">"</span><span class="rvts26">&nbsp;</span><span class="rvts24">/&gt;</span><br/><span class="rvts24">&lt;/</span><span class="rvts25">Binding</span><span class="rvts24">&gt;</span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts14">Finally - add the snippetset to your .vis file as shown below (the provided snippet files are in the custom library)</span></p>
<p class="rvps2"><span class="rvts14"></span><br/><span class="rvts24">&lt;</span><span class="rvts25">SnippetsSets</span><span class="rvts24">&gt;</span><br/><span class="rvts25"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts25">&lt;SnippetsSet</span><span class="rvts26">&nbsp;</span><span class="rvts27">refId</span><span class="rvts24">="</span><span class="rvts28">TrakMapSnippets</span><span class="rvts24">"/&gt;</span><br/><span class="rvts24">&lt;/</span><span class="rvts25">SnippetsSets</span><span class="rvts24">&gt;</span></p>
<p class="rvps2"><span class="rvts24"><br/></span></p>
<p class="rvps2"><span class="rvts15">Theme Definitions</span></p>
<p class="rvps2"><span class="rvts12">The custom widget utilizes some custom themes for the toggle buttons present. You can use your own themes should you like, or you can add the provided style file to your existing theme for styling. The provided .style file will not work alone; it must be added into an existing theme.</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><span class="rvts15">Text Files</span></p>
<p class="rvps2"><span class="rvts12">In the provided files there are the text files. These can be included to populate the error texts, segment statuses, and shuttle statuses in the status widget. Add the provided text files located in the Widget Library Resources package to the text definition for the project (Configuration View&gt;TextSystem&gt;___.textconfig).</span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><img alt="" style="padding : 1px;" src="lib/NewItem6.png"></p>
<p class="rvps2"><img alt="" style="padding : 1px;" src="lib/NewItem5.png"></p>
<p class="rvps2"><span class="rvts24"><br/></span></p>
<p class="rvps2"><span class="rvts22"><br/></span></p>
<p class="rvps2"><span class="rvts22">Optional Features</span></p>
<p class="rvps2"><span class="rvts15"><br/></span></p>
<p class="rvps2"><span class="rvts35"><br/></span></p>
<p class="rvps2"><span class="rvts30"><br/></span></p>
<p></p>

	</div>
	
	
		<div id="topic_footer">

			<div id="topic_footer_content">
				Copyright &copy; &lt;Dates&gt; by &lt;Authors&gt;. All Rights Reserved.
			</div>
		</div>
	
	

	
</body>
	
</html>

