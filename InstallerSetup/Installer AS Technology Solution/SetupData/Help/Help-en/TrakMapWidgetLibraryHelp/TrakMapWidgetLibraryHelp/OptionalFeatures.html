

<html>
	
<head>
	<title>Optional Features</title>
	<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
    <meta name="generator" content="HelpNDoc Professional Edition 6.4.0.357">
	<meta name="description" content="This is a brief overview of how to implement the Acopos Trak paper widget." /> 
	<meta name="keywords" content="">
	
	
	
	<link type="text/css" rel="stylesheet" media="all" href="css/reset.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/base.css" />
	<link type="text/css" rel="stylesheet" media="all" href="css/hnd.css" />
	<!--[if lte IE 8]>
		<link type="text/css" rel="stylesheet" media="all" href="css/ielte8.css" />
	<![endif]-->
	<style type="text/css">
		#topic_header
		{
			background-color: #EFEFEF;
		}
	</style>

	
	
</head>

<body>



	
		<div id="topic_header">
			<div id="topic_header_content">
				<h1 id="topic_header_text">Optional Features</h1>
				
				
			</div>
			
			<div id="topic_header_nav">
				
				
				<a href="Usage.html"><img src="img/arrow_left.png" alt="Previous"/></a>
				
				
			</div>
			
			<div class="clear"></div>
		</div>
	
	
	<div id="topic_content">
		
<p></p>
<p class="rvps2"><span class="rvts15">Enabling Shuttles</span></p>
<p class="rvps2"><span class="rvts12">To enable shuttles, a few actions will need to be taken to ensure proper functionality:</span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<ol style="text-indent: 0px; padding: 0; margin: 0 0 0 48px; list-style-position: outside; list-style-type: decimal;">
<li value="1" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">Update the TrakDiag:paperCore.SvgTransform binding to use a fast sampling rate. This is done in the source of the binding:</span></span></li>
</ol>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<p class="rvps2"><span class="rvts32"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts32"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;Binding</span><span class="rvts33">&nbsp;</span><span class="rvts36">mode</span><span class="rvts30">=</span><span class="rvts31">"twoWay"</span><span class="rvts30">&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;Source</span><span class="rvts33">&nbsp;</span><span class="rvts36">xsi:type</span><span class="rvts30">=</span><span class="rvts31">"opcUa"</span><span class="rvts33">&nbsp;</span><span class="rvts36">refId</span><span class="rvts30">=</span><span class="rvts31">"::TrakDiag:paperCore.SvgTransform"</span><span class="rvts33">&nbsp;</span><span class="rvts36">attribute</span><span class="rvts30">=</span><span class="rvts31">"value"</span><span class="rvts33">&nbsp;</span><span class="rvts36">samplingRate</span><span class="rvts30">=</span><span class="rvts31">"fast"</span><span class="rvts30">/&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;Target</span><span class="rvts33">&nbsp;</span><span class="rvts36">xsi:type</span><span class="rvts30">=</span><span class="rvts31">"brease"</span><span class="rvts33">&nbsp;</span><span class="rvts36">contentRefId</span><span class="rvts30">=</span><span class="rvts31">"trakmapContent"</span><span class="rvts33">&nbsp;</span><span class="rvts36">widgetRefId</span><span class="rvts30">=</span><span class="rvts31">"paperTrakMap"</span><span class="rvts33">&nbsp;</span><span class="rvts36">attribute</span><span class="rvts30">=</span><span class="rvts31">"transform"</span><span class="rvts33">&nbsp;</span><span class="rvts30">/&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;/Binding&gt;</span></p>
<p class="rvps2"><span class="rvts30"> &nbsp; &nbsp; &nbsp; &nbsp;</span></p>
<p class="rvps2"><span class="rvts30"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts14">It is recommended to use the default fast sampling rate of 100ms found in the Config.mappviewcfg file. </span></p>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<ol style="text-indent: 0px; padding: 0; margin: 0 0 0 48px; list-style-position: outside; list-style-type: decimal;">
<li value="2" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">Enable Shuttles through the paperCore FUB by setting </span></span><span class="rvts0"><span class="rvts32">paperOptions.Shuttle.Enabled </span></span><span class="rvts0"><span class="rvts14">to TRUE</span></span></li>
<li value="3" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">Set your maximum shuttle count in the library to match the assembly configuration</span></span></li>
</ol>
<h1 class="rvps5"><img alt="" style="padding : 1px;" src="lib/MaxShuttleCount.png"></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<p class="rvps2"><span class="rvts14">After completing these steps, shuttles should show on the paper widget in a similar way to SceneViewer</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><img alt="" style="padding : 1px;" src="lib/TrakMapWithNonColoredShuttles.png"></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><span class="rvts15">Enabling Shuttle Color</span></p>
<p class="rvps2"><span class="rvts14">To enable shuttle color, </span><span class="rvts12">a few actions will need to be taken to ensure proper functionality:</span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<ol style="text-indent: 0px; padding: 0; margin: 0 0 0 48px; list-style-position: outside; list-style-type: decimal;">
<li value="1" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">The included TrkPaperColorEnum in the TrkPaper library must be used in the Shuttle User Data.</span></span></li>
</ol>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<h1 class="rvps5"><img alt="" style="padding : 1px;" src="lib/TrakPaperColorEnumeration.png"></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<ol style="text-indent: 0px; padding: 0; margin: 0 0 0 48px; list-style-position: outside; list-style-type: decimal;">
<li value="2" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">The colorList of the paper widget must be appended to for the correct colors to show. The paper core function block uses static index values to color. The first 4 values of the colorList will still be used for the segments. The default values for the shuttle color could be the following: </span></span></li>
</ol>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14">#808080,#0000CD,#FF0000,#228B22,#FFFF00,#FFA500,#FFFFFF,#000000,#ff9794,#800080 </span></span></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<ol style="text-indent: 0px; padding: 0; margin: 0 0 0 48px; list-style-position: outside; list-style-type: decimal;">
<li value="3" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">Enable Shuttle Color through the paperCore FUB by setting </span></span><span class="rvts0"><span class="rvts32">paperOptions.Color.Enabled </span></span><span class="rvts0"><span class="rvts14">to TRUE</span></span></li>
<li value="4" style="margin-left: 0px" class="rvps5"><span class="rvts0"><span class="rvts14">Set the color offset for the paperCore FUB to grab the correct color value from the Shuttle User Data. Here is an example Shuttle Data struct:</span></span></li>
</ol>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<h1 class="rvps5"><img alt="" style="padding : 1px;" src="lib/ShuttleUserDataType.png"></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<p class="rvps9"><span class="rvts14">As this example structure has the Color offset by the ID variable, we need to inform the paper core of this offset. And here is the offset needed to get the correct color value:</span></p>
<p class="rvps9"><span class="rvts32"><br/></span></p>
<p class="rvps9"><span class="rvts32">paperOptions.Color.Offset</span><span class="rvts33">&nbsp;</span><span class="rvts34">:=</span><span class="rvts33">&nbsp;</span><span class="rvts31">SIZEOF</span><span class="rvts34">(</span><span class="rvts30">UDINT</span><span class="rvts34">);</span></p>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14">As a note, the typical behavior for ordering variables within a structure applies here. Even though the sample Shuttle User Data has a UINT before the Color variable, a UDINT offset (4 Bytes) is needed since the variables are word-aligned. </span></span><span class="rvts0"><span class="rvts19">An improper offset will cause the colors to not work!!!</span></span></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<h1 class="rvps5"><span class="rvts0"><span class="rvts14"><br/></span></span></h1>
<p class="rvps2"><span class="rvts14">After completing the above steps, shuttles should now have color enabled</span></p>
<p class="rvps2"><span class="rvts14"><br/></span></p>
<p class="rvps2"><img alt="" style="padding : 1px;" src="lib/TrakMapShuttlesWithColor.png"></p>
<p class="rvps2"><span class="rvts15">Shuttle Performance</span></p>
<p class="rvps2"><span class="rvts15"><br/></span></p>
<p class="rvps2"><span class="rvts35">It is important to note, the TrakPaper widget can not and will not be able to replace the speed and precision of shuttle movements that exist inside Scene Viewer. That being said, there are some things you can do to try and increase the preformance out of the system:</span></p>
<p class="rvps2"><span class="rvts35">1. Tweak the transition time inside the paper core</span></p>
<p class="rvps2"><img alt="" style="padding : 1px;" src="lib/Shuttle Transition Time.png"></p>
<p class="rvps2"><span class="rvts35">Increasing this value above the default of 100 to 200 will help for large shuttle count systems. The trade off here is that the shuttle may not follow it's exact path at higher speeds and changing directins (diverts, curves etc)</span></p>
<p class="rvps2"><span class="rvts35"><br/></span></p>
<p class="rvps2"><span class="rvts15">Custom Shuttle Status Widget</span></p>
<p class="rvps2"><span class="rvts15"><br/></span></p>
<p class="rvps2"><span class="rvts12">Add the SegmentStatus widget into your content wherever you desire. Connect the TrakDiag:paperCore.ClickData.Shuttle.Data.ShInfo variable to the widget. Also, connect the TrakDiag:paperCore.ClickData.Shuttle.Valid variable to the visible property of the widget. The shuttle data also outputs the axis of the clicked shuttle in TrakDiag:paperCore.ClickData.Shuttle.Data.Axis. </span></p>
<p class="rvps2"><span class="rvts12"><br/></span></p>
<p class="rvps2"><span class="rvts12">If TrakDiag:paperCore.ClickData.Shuttle.Valid is true, then the Axis is valid and is able to be used as an input in function blocks. If the axis is not valid, then a page fault may occur if that address is attempted to be accessed. </span><span class="rvts38">Only use the shuttle axis output when valid is true!</span></p>
<p class="rvps2"><span class="rvts22"><br/></span></p>
<p class="rvps2"><span class="rvts15">Shuttle User Data Example</span></p>
<p class="rvps2"><span class="rvts15"><br/></span></p>
<p class="rvps2"><span class="rvts35">Trak Paper Core includes an example widget to display custom user data in a similar manner to the shuttle and segment info widgets.</span></p>
<p class="rvps2"><span class="rvts35"><br/></span></p>
<p class="rvps2"><img alt="" style="padding : 1px;" src="lib/ShuttleUserDataWidget.png"></p>
<p class="rvps2"><span class="rvts35"><br/></span></p>
<p class="rvps2"><span class="rvts35"><br/></span></p>
<p class="rvps2"><span class="rvts35">In the cyclic task of TrakDiag, the shuttle user data of a shuttle is accessed on the positive edge of a valid shuttle identification:</span></p>
<p class="rvps2"><span class="rvts35"><br/></span></p>
<p class="rvps2"><span class="rvts32"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts37">//Fetch</span><span class="rvts33">&nbsp;</span><span class="rvts37">ShuttleUserData</span><span class="rvts33">&nbsp;</span><span class="rvts37">Example</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts31">IF</span><span class="rvts33">&nbsp;</span><span class="rvts31">EDGEPOS</span><span class="rvts34">(paperCore.ClickData.Shuttle.Valid)</span><span class="rvts33">&nbsp;</span><span class="rvts31">THEN</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34">MC_BR_ShCopyUserData_AcpTrak_0.Axis</span><span class="rvts33">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34">:=</span><span class="rvts33">&nbsp;</span><span class="rvts31">ADR</span><span class="rvts34">(paperCore.ClickData.Shuttle.Data.Axis);</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34">MC_BR_ShCopyUserData_AcpTrak_0.Execute</span><span class="rvts33">&nbsp; &nbsp; &nbsp; </span><span class="rvts34">:=</span><span class="rvts33">&nbsp;</span><span class="rvts31">TRUE</span><span class="rvts34">;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34">MC_BR_ShCopyUserData_AcpTrak_0.DataAddress</span><span class="rvts33">&nbsp; </span><span class="rvts34">:=</span><span class="rvts33">&nbsp;</span><span class="rvts31">ADR</span><span class="rvts34">(ShuttleUserData);</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34">MC_BR_ShCopyUserData_AcpTrak_0.DataSize</span><span class="rvts33">&nbsp; &nbsp; &nbsp;</span><span class="rvts34">:=</span><span class="rvts33">&nbsp;</span><span class="rvts31">SIZEOF</span><span class="rvts34">(ShuttleUserData);</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34">MC_BR_ShCopyUserData_AcpTrak_0.Mode</span><span class="rvts33">&nbsp; &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34">:=</span><span class="rvts33">&nbsp;</span><span class="rvts34">mcACPTRAK_USERDATA_GET;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts31">END_IF</span></p>
<p class="rvps2"><span class="rvts31"><br/></span></p>
<p class="rvps2"><span class="rvts31"><br/></span></p>
<p class="rvps2"><span class="rvts35">The example shuttle user data widget uses the resulting ShuttleUserData as an input and ties its visible property to the valid shuttle variable.</span></p>
<p class="rvps2"><span class="rvts35"><br/></span></p>
<p class="rvps2"><span class="rvts32"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts32"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;Binding</span><span class="rvts33">&nbsp;</span><span class="rvts36">mode</span><span class="rvts30">=</span><span class="rvts31">"twoWay"</span><span class="rvts30">&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;Source</span><span class="rvts33">&nbsp;</span><span class="rvts36">xsi:type</span><span class="rvts30">=</span><span class="rvts31">"opcUaComplexObject"</span><span class="rvts33">&nbsp;</span><span class="rvts36">refId</span><span class="rvts30">=</span><span class="rvts31">"NS6|String|Diag::TrakDiag:ShuttleUserData"</span><span class="rvts33">&nbsp;</span><span class="rvts30">/&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;Target</span><span class="rvts33">&nbsp;</span><span class="rvts36">xsi:type</span><span class="rvts30">=</span><span class="rvts31">"brease"</span><span class="rvts33">&nbsp;</span><span class="rvts36">contentRefId</span><span class="rvts30">=</span><span class="rvts31">"trakmapContent"</span><span class="rvts33">&nbsp;</span><span class="rvts36">widgetRefId</span><span class="rvts30">=</span><span class="rvts31">"ShuttleUserDataExample1"</span><span class="rvts33">&nbsp;</span><span class="rvts36">attribute</span><span class="rvts30">=</span><span class="rvts31">"userData"</span><span class="rvts33">&nbsp;</span><span class="rvts30">/&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;/Binding&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;Binding</span><span class="rvts33">&nbsp;</span><span class="rvts36">mode</span><span class="rvts30">=</span><span class="rvts31">"twoWay"</span><span class="rvts30">&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;Source</span><span class="rvts33">&nbsp;</span><span class="rvts36">xsi:type</span><span class="rvts30">=</span><span class="rvts31">"opcUa"</span><span class="rvts33">&nbsp;</span><span class="rvts36">refId</span><span class="rvts30">=</span><span class="rvts31">"NS6|String|Diag::TrakDiag:paperCore.ClickData.Shuttle.Valid"</span><span class="rvts33">&nbsp;</span><span class="rvts36">attribute</span><span class="rvts30">=</span><span class="rvts31">"value"</span><span class="rvts33">&nbsp;</span><span class="rvts30">/&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;Target</span><span class="rvts33">&nbsp;</span><span class="rvts36">xsi:type</span><span class="rvts30">=</span><span class="rvts31">"brease"</span><span class="rvts33">&nbsp;</span><span class="rvts36">contentRefId</span><span class="rvts30">=</span><span class="rvts31">"trakmapContent"</span><span class="rvts33">&nbsp;</span><span class="rvts36">widgetRefId</span><span class="rvts30">=</span><span class="rvts31">"ShuttleUserDataExample1"</span><span class="rvts33">&nbsp;</span><span class="rvts36">attribute</span><span class="rvts30">=</span><span class="rvts31">"visible"</span><span class="rvts33">&nbsp;</span><span class="rvts30">/&gt;</span><br/><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts34"> &nbsp; &nbsp; &nbsp; &nbsp;</span><span class="rvts30">&lt;/Binding&gt;</span></p>
<p class="rvps2"><span class="rvts30"><br/></span></p>
<p class="rvps2"><span class="rvts35">The example widget can be expanded by the user by adding to the defined ShuttleUserData type and adding more outputs to show the desired data.</span></p>
<p></p>

	</div>
	
	
		<div id="topic_footer">

			<div id="topic_footer_content">
				Copyright &copy; &lt;Dates&gt; by &lt;Authors&gt;. All Rights Reserved.
			</div>
		</div>
	
	

	
</body>
	
</html>

